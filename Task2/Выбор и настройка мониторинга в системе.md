## Мотивация
Мониторинг — сбор бизнесовых и инфраструктурных метрик (metrics).
- Мониторинг производительности. Повышение быстродействия системы и распределение ресурсов. Можно выявлять узкие места. Помогает оптимизировать производительность — вы можете проанализировать, как система работает под разными нагрузками. Это приоритет номер один в нашем случае.
- Повышение удовлетворённости пользователей. Своевременное решение проблем, которые связаны с производительностью и функциональностью приложения, улучшает пользовательский опыт. Это приоритет номер два, пользователи жалуются.
- Ускорение рабочего процесса и DevOps. Наблюдаемость способствует оптимизации процессов и сокращению количества ошибок что помогает ускорить рабочий процесс и улучшить взаимодействие между командами. Команду нужно расширять и лучше сразу эффективно использовать новых сотрудников лучшим образом окупая затраты на расширение штата.
- Мониторинг безопасности. Улучшение видимости и повышение безопасности системы. Поможет получить полное представление о работе системы. Чем выше видимость, тем проще обеспечить безопасность. Минимизирует риски диверсий со стороны конкурентов или ошибок со стороны пользователей открытого MES API.
- Ценные бизнес-инсайты. Накопленные данные могут привести вас к бизнес-инсайтам и помогут принимать стратегические решения более обоснованно.


## Выбор подхода к мониторингу
Системе рекомендуется кеширование данных, но важно понимание насыщенности, поэтому лучше подходит «Четыре золотых сигнала», особенно для вычислительной части MES API.
Тем не менее для мониторинга баз данных можно использовать USE. Для запрос-ориентированных сервисов без вычислительной нагрузки можно использовать RED. 

## Выбор метрик

Брокер сообщений:
- Number of dead-letter-exchange letters in RabbitMQ: ошибки, отладка
- Number of message in flight in RabbitMQ: загруженность, масштабирование

MES
- Number of requests (RPS) for MES API: загруженность, масштабирование
- CPU % for MES API: загруженность вычислительных мощностей, масштабирование
- Memory Utilisation for MES API: загруженность вычислительных мощностей, масштабирование
- Memory Utilisation for MES db instance: загруженность, масштабирование
- Size of MES db instance: загруженность, масштабирование, очистка базы данных от старых моделей
- Response time (latency) for MES API: оптимизации долгих запросов, кеширование
- Number of HTTP 500 for MES API: ошибки, отладка
- Price calculation time: инсайт, оптимизация
- Prefab 3d element use count: инсайт, фидбек, оптимизация

Shop
- Number of requests (RPS) for internet shop API: загруженность, масштабирование
- Number of requests (RPS) per user for internet shop API: безопасность, анти-спам
- Memory Utilisation for shop db instance: загруженность, масштабирование
- Response time (latency) for shop API: оптимизации долгих запросов, кеширование
- Number of HTTP 500 for shop API: ошибки, отладка

CRM
- Number of requests (RPS) for CRM API: загруженность, масштабирование
- Response time (latency) for CRM API: оптимизации долгих запросов, кеширование
- Number of HTTP 500 for CRM API: ошибки, отладка

Можно добавить следующие метки:
- полагается что идентификаторы сервиса и инстанса есть по умолчанию в Prometheus (instance)
- полагается что тип запроса/ошибки есть по умолчанию в Prometheus (job)
- группа/роль пользователя связанного с запросом


## План действий
- Реализовать генерацию метрик в приложениях/сервисах
- Развернуть Prometheus: создать docker образ, создать файл конфигурации, задать список сервисов для извлечения метрик
- Настроить Grafana для работы с сервером Prometheus
- Настроить в Grafana дашборды и метрики для визуализации
